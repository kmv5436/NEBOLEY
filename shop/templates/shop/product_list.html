{% extends "shop/base.html" %}

{% block title %}{{ page_title }} - –ú–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä–æ–≤{% endblock %}
{% block header %}{{ page_title }}{% endblock %}

{% block content %}
<div class="filters">
    <form method="get" action=".">
        <h3>–§–∏–ª—å—Ç—Ä—ã:</h3>
        
        <label for="q">–ü–æ–∏—Å–∫:</label>
        <input type="text" name="q" id="q" value="{{ search_query }}" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...">
        
        <label for="size">–†–∞–∑–º–µ—Ä:</label>
        <select name="size" id="size">
            <option value="all">–í—Å–µ —Ä–∞–∑–º–µ—Ä—ã</option>
            {% for size in available_sizes %}
            <option value="{{ size }}" {% if size_filter == size %}selected{% endif %}>
                {{ size }}
            </option>
            {% endfor %}
        </select>
        
        <label for="price_min">–¶–µ–Ω–∞ –æ—Ç:</label>
        <input type="number" name="price_min" id="price_min" value="{{ price_min }}" placeholder="0" step="0.01">
        
        <label for="price_max">–¶–µ–Ω–∞ –¥–æ:</label>
        <input type="number" name="price_max" id="price_max" value="{{ price_max }}" placeholder="10000" step="0.01">
        
        <label for="sort">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
        <select name="sort" id="sort">
            {% for key, name in sort_options.items %}
            <option value="{{ key }}" {% if sort_by == key %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>
        
        <select name="order">
            {% for key, name in order_options.items %}
            <option value="{{ key }}" {% if order == key %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>
        
        <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <a href=".">–°–±—Ä–æ—Å–∏—Ç—å</a>
    </form>
</div>

{% if category %}
    <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ category.name }}</h2>
    {% if category.description %}
        <p>{{ category.description }}</p>
    {% endif %}
{% endif %}

<div class="product-grid">
    {% for product in products %}
    <div class="product-card">
        {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image" 
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="product-image" style="background: #eee; display: none; align-items: center; justify-content: center;">
                üì∑ –ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            </div>
        {% else %}
            <div class="product-image" style="background: #eee; display: flex; align-items: center; justify-content: center;">
                üì∑ –ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            </div>
        {% endif %}
        
        <h3><a href="{% url 'shop:product_detail' product.slug %}">{{ product.name }}</a></h3>
        
        <p>–†–∞–∑–º–µ—Ä: {{ product.get_size_display }}</p>
        
        <div class="price">
            {% if product.old_price %}
                <span class="old-price">{{ product.get_old_price_display }}</span>
            {% endif %}
            <span>{{ product.get_price_display }}</span>
        </div>
        
        <p>‚úÖ –í –Ω–∞–ª–∏—á–∏–∏</p>
        
        <a href="{% url 'shop:product_detail' product.slug %}" style="background: #007bff; color: white; padding: 8px 15px; text-decoration: none; border-radius: 3px;">
            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
        </a>
    </div>
    {% empty %}
    <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
        <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
    </div>
    {% endfor %}
</div>

{% if products.has_other_pages %}
<div class="pagination">
    {% if products.has_previous %}
        <a href="?page={{ products.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">‚Üê –ù–∞–∑–∞–¥</a>
    {% endif %}
    
    {% for i in products.paginator.page_range %}
        {% if products.number == i %}
            <span class="current">{{ i }}</span>
        {% else %}
            <a href="?page={{ i }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{{ i }}</a>
        {% endif %}
    {% endfor %}
    
    {% if products.has_next %}
        <a href="?page={{ products.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}