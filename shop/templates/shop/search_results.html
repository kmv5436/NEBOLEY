{% extends "shop/base.html" %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -  NEBOLEY{% endblock %}
{% block header %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞{% endblock %}

{% block content %}
<div style="margin-bottom: 30px;">
    <form method="get" action="{% url 'shop:search_results' %}" style="display: flex; gap: 10px; align-items: center;">
        <input type="text" name="q" value="{{ search_query }}" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." 
               style="flex: 1; padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 5px;">
        <button type="submit" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
            üîç –ü–æ–∏—Å–∫
        </button>
    </form>
</div>

{% if search_query %}
    <div style="margin-bottom: 20px;">
        <p>–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: <strong>{{ results_count }}</strong></p>
        <p>–ü–æ –∑–∞–ø—Ä–æ—Å—É: "<strong>{{ search_query }}</strong>"</p>
    </div>
{% endif %}

{% if products %}
    <div class="product-grid">
        {% for product in products %}
        <div class="product-card">
            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
            {% else %}
                <div class="product-image" style="background: #eee; display: flex; align-items: center; justify-content: center;">
                    –ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                </div>
            {% endif %}
            
            <h3><a href="{% url 'shop:product_detail' product.slug %}">{{ product.name }}</a></h3>
            
            <p>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ product.category.name }}</p>
            <p>–†–∞–∑–º–µ—Ä: {{ product.get_size_display }}</p>
            
            <div class="price">
                {% if product.old_price %}
                    <span class="old-price">{{ product.get_old_price_display }}</span>
                {% endif %}
                <span>{{ product.get_price_display }}</span>
            </div>
            
            <p>{% if product.in_stock %}‚úÖ –í –Ω–∞–ª–∏—á–∏–∏{% else %}‚ùå –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏{% endif %}</p>
            
            <a href="{% url 'shop:product_detail' product.slug %}" style="background: #007bff; color: white; padding: 8px 15px; text-decoration: none; border-radius: 3px;">
                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
            </a>
        </div>
        {% endfor %}
    </div>
{% else %}
    {% if search_query %}
    <div style="text-align: center; padding: 60px 20px;">
        <h3>üòî –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥—Ä—É–≥–∏–µ –Ω–∞—à–∏ —Ç–æ–≤–∞—Ä—ã</p>
        <div style="margin-top: 20px;">
            <a href="{% url 'shop:product_list' %}" style="background: #28a745; color: white; padding: 12px 25px; text-decoration: none; border-radius: 5px; margin-right: 10px;">
                –í—Å–µ —Ç–æ–≤–∞—Ä—ã
            </a>
            <a href="{% url 'shop:featured_products' %}" style="background: #ffc107; color: #333; padding: 12px 25px; text-decoration: none; border-radius: 5px;">
                –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ
            </a>
        </div>
    </div>
    {% else %}
    <div style="text-align: center; padding: 60px 20px;">
        <h3>üîç –í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</h3>
        <p>–ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ç–æ–≤–∞—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</p>
    </div>
    {% endif %}
{% endif %}

{% if products.has_other_pages %}
<div class="pagination">
    {% if products.has_previous %}
        <a href="?q={{ search_query }}&page={{ products.previous_page_number }}">‚Üê –ù–∞–∑–∞–¥</a>
    {% endif %}
    
    {% for i in products.paginator.page_range %}
        {% if products.number == i %}
            <span class="current">{{ i }}</span>
        {% else %}
            <a href="?q={{ search_query }}&page={{ i }}">{{ i }}</a>
        {% endif %}
    {% endfor %}
    
    {% if products.has_next %}
        <a href="?q={{ search_query }}&page={{ products.next_page_number }}">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
    {% endif %}
</div>
{% endif %}

{% if not search_query and not products %}
<div style="margin-top: 40px;">
    <h3>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</h3>
    <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px;">
        {% for category in categories %}
        <a href="{% url 'shop:product_list_by_category' category.slug %}" 
           style="background: #f8f9fa; padding: 10px 20px; border-radius: 20px; text-decoration: none; color: #333; border: 1px solid #ddd;">
            {{ category.name }}
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}